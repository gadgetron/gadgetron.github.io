<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Gadgetron: gtPlusSPIRIT.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Gadgetron
   </div>
   <div id="projectbrief">AStreamingFrameworkforMedicalImageReconstruction</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_cf1beb539ef5c09a983cc00836e8c765.html">toolboxes</a></li><li class="navelem"><a class="el" href="dir_7975f6e9077da63b7272bca4414418ee.html">gtplus</a></li><li class="navelem"><a class="el" href="dir_2a91dca448cacbd01bd84b2f40fab448.html">algorithm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">gtPlusSPIRIT.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="gt_plus_s_p_i_r_i_t_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#pragma once</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gt_plus_algorithm_base_8h.html">gtPlusAlgorithmBase.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mri__core__spirit_8h.html">mri_core_spirit.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">namespace </span>Gadgetron { <span class="keyword">namespace </span>gtPlus {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">   26</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">gtPlusSPIRIT</a> : <span class="keyword">public</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_algorithm_base.html">gtPlusAlgorithmBase</a>&lt;T&gt;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;{</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_algorithm_base.html">gtPlusAlgorithmBase&lt;T&gt;</a> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_algorithm_base.html">BaseClass</a>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="struct_gadgetron_1_1real_type.html">realType&lt;T&gt;::Type</a> ValueType;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">gtPlusSPIRIT</a>() : calib_use_gpu_(<span class="keyword">true</span>), <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_algorithm_base.html">BaseClass</a>() {}</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">gtPlusSPIRIT</a>() {}</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> printInfo(std::ostream&amp; os);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// SPIRIT calibration for 2D case</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// acsSrc : [RO E1 srcCHA]</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// acsDst : [RO E1 dstCHA]</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// ker : [kRO kE1 srcCHA dstCHA oRO oE1]</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">bool</span> calib(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho3_d_array.html">ho3DArray&lt;T&gt;</a>&amp; acsSrc, <span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho3_d_array.html">ho3DArray&lt;T&gt;</a>&amp; acsDst, <span class="keywordtype">double</span> thres, </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <a class="code" href="class_gadgetron_1_1ho6_d_array.html">ho6DArray&lt;T&gt;</a>&amp; ker);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// image domain kernel for 2D kernel</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// kIm: image domain kernel [RO E1 srcCHA dstCHA]</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// if minusI==true, compute image domain G-I kernel</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#ad566c30ab4e06acbf21830beef6db73e">imageDomainKernel</a>(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho6_d_array.html">ho6DArray&lt;T&gt;</a>&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> ro, <span class="keywordtype">size_t</span> e1, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kIm, <span class="keywordtype">bool</span> minusI=<span class="keyword">false</span>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// SPIRIT calibration for 3D case</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// acsSrc : [RO E1 E2 srcCHA]</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// acsDst : [RO E1 E2 dstCHA]</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// ker : [kRO kE1 kE2 srcCHA dstCHA oRO oE1 oE2]</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// overDetermineRatio : over determine ratio of calib matrix, if &lt; 1, all data are used</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordtype">bool</span> calib3D(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho4_d_array.html">ho4DArray&lt;T&gt;</a>&amp; acsSrc, <span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho4_d_array.html">ho4DArray&lt;T&gt;</a>&amp; acsDst, <span class="keywordtype">double</span> thres, <span class="keywordtype">double</span> overDetermineRatio, </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; ker);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// convert the calibrated kernel to the convlution kernel in kspace</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// if ROis3rdDim == true, the kernel dimension is [E1 E2 RO], otherwise [RO E1 E2]</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#a511dda6e65a571935534cc264f8d3ae9">kspaceDomainConvKernel3D</a>(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <a class="code" href="class_gadgetron_1_1ho5_d_array.html">ho5DArray&lt;T&gt;</a>&amp; convKerFlip, <span class="keywordtype">bool</span> minusI=<span class="keyword">true</span>, <span class="keywordtype">bool</span> ROis3rdDim=<span class="keyword">true</span>);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// image domain kernel for 3D kernel</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// kIm: image domain kernel [E1 E2 RO srcCHA dstCHA]</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// if minusI==true, compute image domain G-I kernel</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordtype">bool</span> imageDomainKernel3D(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <span class="keywordtype">size_t</span> ro, <span class="keywordtype">size_t</span> e1, <span class="keywordtype">size_t</span> e2, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kIm, <span class="keywordtype">bool</span> minusI=<span class="keyword">false</span>);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// image domain kernel for 3D kernel, only RO direction is converted to image domain</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// E1 and E2 stays in the kspace domain</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// kImRO: kspace-image hybrid kernel [convE1 convE2 RO srcCHA dstCHA]</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordtype">bool</span> imageDomainKernelRO3D(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <span class="keywordtype">size_t</span> ro, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kImRO, <span class="keywordtype">bool</span> minusI=<span class="keyword">false</span>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// image domain kernel for 3D kernel, E1 and E2 directions are converted to image domain</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// kImRO : kspace-image hybrid kernel where first two dimensions are E1 and E2 and in kspace</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">bool</span> imageDomainKernelE1E2RO(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kImRO, <span class="keywordtype">size_t</span> e1, <span class="keywordtype">size_t</span> e2, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kImE1E2RO);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// compute the image domain adjoint kernel</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">bool</span> imageDomainAdjointKernel(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kIm, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; adjkIm);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// compute the (G-I)&#39;*(G-I)</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">bool</span> AdjointForwardKernel(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kImS2D, <span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kImD2S, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kIm);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// use gpu in the kernel calibration</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">bool</span> calib_use_gpu_;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">using</span> BaseClass::gt_timer1_;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keyword">using</span> BaseClass::gt_timer2_;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keyword">using</span> BaseClass::gt_timer3_;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">using</span> BaseClass::performTiming_;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keyword">using</span> BaseClass::gt_exporter_;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">using</span> BaseClass::debugFolder_;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keyword">using</span> BaseClass::gtPlus_util_;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">using</span> BaseClass::gtPlus_util_complex_;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;};</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">gtPlusSPIRIT&lt;T&gt;::printInfo</a>(std::ostream&amp; os)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;-------------- GTPlus ISMRMRD SPIRIT reconstruction ------------------&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Implementation of SPIRIT algorithms for ISMRMRD package&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Both 2D and 3D version are implemented&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Algorithms are published at:&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;Lustig, M. and Pauly, J. M. (2010), SPIRiT: Iterative self-consistent parallel imaging reconstruction from arbitrary k-space. Magn Reson Med, 64: 457ï¿½471. doi: 10.1002/mrm.22428&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;----------------------------------------------------------------------&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keywordtype">bool</span> gtPlusSPIRIT&lt;T&gt;::</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;calib(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho3_d_array.html">ho3DArray&lt;T&gt;</a>&amp; acsSrc, <span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho3_d_array.html">ho3DArray&lt;T&gt;</a>&amp; acsDst, <span class="keywordtype">double</span> thres, </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <a class="code" href="class_gadgetron_1_1ho6_d_array.html">ho6DArray&lt;T&gt;</a>&amp; ker)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        GADGET_CHECK_RETURN_FALSE(acsSrc.get_size(0)==acsDst.get_size(0));</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        GADGET_CHECK_RETURN_FALSE(acsSrc.get_size(1)==acsDst.get_size(1));</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        GADGET_CHECK_RETURN_FALSE(acsSrc.get_size(2)&gt;=acsDst.get_size(2));</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordtype">size_t</span> RO = acsSrc.get_size(0);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordtype">size_t</span> E1 = acsSrc.get_size(1);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordtype">size_t</span> srcCHA = acsSrc.get_size(2);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordtype">size_t</span> dstCHA = acsDst.get_size(2);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kROhalf = kRO/2;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">if</span> ( 2*kROhalf == kRO )</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib(...) - 2*kROhalf == kRO &quot;</span> &lt;&lt; kRO);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        kRO = 2*kROhalf + 1;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kE1half = kE1/2;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">if</span> ( 2*kE1half == kE1 )</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib(...) - 2*kE1half == kE1 &quot;</span> &lt;&lt; kE1);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        kE1 = 2*kE1half + 1;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">if</span> ( oRO &gt; kRO ) oRO = kRO;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span> ( oE1 &gt; kE1 ) oE1 = kE1;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oROhalf = oRO/2;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordflow">if</span> ( 2*oROhalf == oRO )</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib(...) - 2*oROhalf == oRO &quot;</span> &lt;&lt; oRO);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        oRO = 2*oROhalf + 1;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oE1half = oE1/2;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> ( 2*oE1half == oE1 )</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib(...) - 2*oE1half == oE1 &quot;</span> &lt;&lt; oE1);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        oE1 = 2*oE1half + 1;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// allocate kernel</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        GADGET_CHECK_RETURN_FALSE(ker.createArray(kRO, kE1, srcCHA, dstCHA, oRO, oE1));</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">// loop over the calibration region and assemble the equation</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">// Ax = b</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordtype">size_t</span> sRO = kROhalf;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordtype">size_t</span> eRO = RO - kROhalf -1;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordtype">size_t</span> sE1 = kE1half;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordtype">size_t</span> eE1 = E1 - kE1half -1;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordtype">size_t</span> lenRO = eRO-sRO+1;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordtype">size_t</span> lenE1 = eE1-sE1+1;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordtype">size_t</span> rowA = lenE1*lenRO;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordtype">size_t</span> colA = (kRO*kE1-1)*srcCHA;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordtype">size_t</span> colB = dstCHA;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordtype">bool</span> useGPU = (<span class="keyword">typeid</span>(<span class="keyword">typename</span> realType&lt;T&gt;::Type)==<span class="keyword">typeid</span>(<span class="keywordtype">float</span>) &amp;&amp; calib_use_gpu_);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="comment">//if ( useGPU )</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">//{</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">//    GDEBUG_STREAM(&quot;spirit 2D - calling GPU kernel estimation ... &quot;); </span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">//}</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keyword">const</span> T* pAcsSrc = acsSrc.begin();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">        #pragma omp parallel default(none) shared(RO, E1, sRO, eRO, sE1, eE1, oRO, oE1, lenRO, lenE1, rowA, colA, colB, kRO, kE1, kROhalf, kE1half, oROhalf, oE1half, pAcsSrc, acsSrc, acsDst, srcCHA, dstCHA, thres, ker, useGPU, std::cout) num_threads( (int)(oRO*oE1) ) if (oRO*oE1&gt;=3)</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor"></span>        {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            hoMatrix&lt;T&gt; A(rowA, colA);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            T* pA = A.begin();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            hoMatrix&lt;T&gt; B(rowA, colB);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            T* pB = B.begin();</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            hoMatrix&lt;T&gt; x( A.cols(), B.cols() );</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordtype">long</span> <span class="keywordtype">long</span> kInd = 0;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">            #pragma omp for</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">for</span> ( kInd=0; kInd&lt;(<span class="keywordtype">long</span> long)(oRO*oE1); kInd++ )</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> oe1 = kInd/oRO;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> oro = kInd - oe1*oRO;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                oe1 -=oE1half;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                oro -=oROhalf;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> dRO, dE1;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> e1=(<span class="keywordtype">long</span> <span class="keywordtype">long</span>)sE1; e1&lt;=(<span class="keywordtype">long</span> long)eE1; e1++ )</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    dE1 = e1 + oe1;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ro=sRO; ro&lt;=(<span class="keywordtype">long</span> long)eRO; ro++ )</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        dRO = ro + oro;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        <span class="keywordtype">long</span> <span class="keywordtype">long</span> rInd = (e1-sE1)*lenRO+ro-sRO;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        <span class="comment">// fill matrix A</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                        <span class="keywordtype">size_t</span> col = 0;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                        {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                            <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ke1=-kE1half; ke1&lt;=kE1half; ke1++ )</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                            {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> kro=-kROhalf; kro&lt;=kROhalf; kro++ )</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                    <span class="keywordflow">if</span> ( kro!=oro || ke1!=oe1 )</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                    {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                                        <span class="comment">//A(rInd, col++) = acsSrc(ro+kro, e1+ke1, src);</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                        <span class="comment">// pA[rInd + col*rowA] = acsSrc(ro+kro, e1+ke1, src);</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                        pA[rInd + col*rowA] = pAcsSrc[ro+kro + (e1+ke1)*RO + src*RO*E1];</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                        col++;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                            }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        <span class="comment">// fill matrix B</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                        {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                            <span class="comment">//B(rInd, dst) = acsDst(dRO, dE1, dst);</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                            pB[rInd+dst*rowA] = acsDst(dRO, dE1, dst);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="comment">// GADGET_CHECK_RETURN_FALSE(SolveLinearSystem_Tikhonov(A, B, x, thres));</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="comment">//if ( performTiming_ ) { gt_timer3_.start(&quot;grappa 3D calibration - solve linear system ... &quot;); }</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="comment">//#ifdef USE_CUDA</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <span class="comment">//    // go to device</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="comment">//    try</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="comment">//    {</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="comment">//        if ( useGPU )</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="comment">//        {</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="comment">//            hoNDArray&lt;float_complext&gt; A_tmp(A.get_dimensions(), reinterpret_cast&lt;float_complext*&gt;(A.begin()));</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="comment">//            hoNDArray&lt;float_complext&gt; B_tmp(B.get_dimensions(), reinterpret_cast&lt;float_complext*&gt;(B.begin()));</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                <span class="comment">//            int ret(0);</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                <span class="comment">//            boost::shared_ptr&lt; hoNDArray&lt;complext&lt;float&gt; &gt; &gt; host_x;</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                <span class="comment">//            #pragma omp critical(inverse_spirit)</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                <span class="comment">//            {</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="comment">//                cuNDArray&lt;float_complext&gt; device_A(A_tmp);</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="comment">//                cuNDArray&lt;float_complext&gt; device_B(B_tmp);</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                <span class="comment">//                cuNDArray&lt;float_complext&gt; device_x;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="comment">//                ret = Gadgetron::inverse_clib_matrix(&amp;device_A, &amp;device_B, &amp;device_x, thres);</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="comment">//                if ( ret == 0 )</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="comment">//                {</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                <span class="comment">//                    host_x = device_x.to_host();</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="comment">//                }</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="comment">//            }</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                <span class="comment">//            if ( ret != 0 )</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="comment">//            {</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <span class="comment">//                GERROR_STREAM(&quot;failed in Gadgetron::inverse_clib_matrix(&amp;device_A, &amp;device_B, &amp;device_x, thres) ... &quot;);</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <span class="comment">//                SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="comment">//            }</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="comment">//            else</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="comment">//            {</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="comment">//                memcpy(x.begin(), host_x-&gt;begin(), host_x-&gt;get_number_of_bytes());</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="comment">//            }</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="comment">//        }</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="comment">//        else</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="comment">//        {</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="comment">//            GWARN_STREAM(&quot;GPU inverse_clib_matrix is only available for single-precision, calling the CPU version ... &quot;);</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <span class="comment">//            SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="comment">//        }</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                <span class="comment">//    }</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="comment">//    catch(...)</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="comment">//    {</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="comment">//        GERROR_STREAM(&quot;failed in GPU inverse_clib_matrix for grappa, calling the CPU version ... &quot;);</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                <span class="comment">//        SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                <span class="comment">//    }</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                <span class="comment">//#else</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                    <a class="code" href="namespace_gadgetron.html#aa27c6f79324f87af705a03bdee309cc4">SolveLinearSystem_Tikhonov</a>(A, B, x, thres);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="comment">//#endif // USE_CUDA</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="comment">//if ( performTiming_ ) { gt_timer3_.stop(); }</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                <span class="comment">//SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> ind(0);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ke1=-kE1half; ke1&lt;=kE1half; ke1++ ) </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                    {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> kro=-kROhalf; kro&lt;=kROhalf; kro++ ) </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                        {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                            <span class="keywordflow">if</span> ( kro!=oro || ke1!=oe1 )</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                            {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                    ker(kro+kROhalf, ke1+kE1half, src, dst, oro+oROhalf, oe1+oE1half) = x(ind, dst);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                ind++;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                            }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                            {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                    ker(kro+kROhalf, ke1+kE1half, src, dst, oro+oROhalf, oe1+oE1half) = 0;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                            }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                        }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        }</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::calib(...) ... &quot;</span>);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#ad566c30ab4e06acbf21830beef6db73e">gtPlusSPIRIT&lt;T&gt;::</a></div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#ad566c30ab4e06acbf21830beef6db73e">  341</a></span>&#160;<a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#ad566c30ab4e06acbf21830beef6db73e">imageDomainKernel</a>(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho6_d_array.html">ho6DArray&lt;T&gt;</a>&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> ro, <span class="keywordtype">size_t</span> e1, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kIm, <span class="keywordtype">bool</span> minusI)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;{</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> srcCHA = (<span class="keywordtype">long</span> long)(ker.get_size(2));</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> dstCHA = (<span class="keywordtype">long</span> long)(ker.get_size(3));</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        GADGET_CHECK_RETURN_FALSE(kRO==ker.get_size(0));</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        GADGET_CHECK_RETURN_FALSE(kE1==ker.get_size(1));</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        GADGET_CHECK_RETURN_FALSE(oRO==ker.get_size(4));</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        GADGET_CHECK_RETURN_FALSE(oE1==ker.get_size(5));</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kROhalf = kRO/2;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kE1half = kE1/2;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oROhalf = oRO/2;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oE1half = oE1/2;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="comment">// allocate image domain kernel</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        kIm.create(ro, e1, srcCHA, dstCHA);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> convKRO = 2*kRO-1;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> convKE1 = 2*kE1-1;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <a class="code" href="class_gadgetron_1_1ho6_d_array.html">ho6DArray&lt;T&gt;</a> convKer(convKRO, convKE1, srcCHA, dstCHA, oRO, oE1);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a>(&amp;convKer);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oro, oe1, kro, ke1, src, dst;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">for</span> ( oe1=-oE1half; oe1&lt;=oE1half; oe1++ )</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="keywordflow">for</span> ( oro=-oROhalf; oro&lt;=oROhalf; oro++ )</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordflow">for</span> ( ke1=-kE1half; ke1&lt;=kE1half; ke1++ )</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    <span class="keywordflow">for</span> ( kro=-kROhalf; kro&lt;=kROhalf; kro++ )</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                    {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                        <span class="keywordtype">long</span> <span class="keywordtype">long</span> iro = kro - oro + kRO -1;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                        <span class="keywordtype">long</span> <span class="keywordtype">long</span> ie1 = ke1 - oe1 + kE1 -1;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                            <span class="keywordflow">for</span> ( src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                            {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                convKer(iro, ie1, src, dst, oro+oROhalf, oe1+oE1half) = ker(kro+kROhalf, ke1+kE1half, src, dst, oro+oROhalf, oe1+oE1half);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                            }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                        }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                    }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a> convKer2;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a> conKerMean(convKRO, convKE1, srcCHA, dstCHA, 1, 1);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment">//GADGET_CHECK_RETURN_FALSE(Gadgetron::sumOverLastDimension(convKer, convKer2));</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment">//GADGET_CHECK_RETURN_FALSE(Gadgetron::sumOverLastDimension(convKer2, conKerMean));</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a>(convKer, convKer2, 5));</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a>(convKer2, conKerMean, 4));</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::scal( (<span class="keyword">typename</span> <a class="code" href="struct_gadgetron_1_1real_type.html">realType&lt;T&gt;::Type</a>)(1.0/(oRO*oE1)), conKerMean) );</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="comment">// flip the kernel</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <a class="code" href="class_gadgetron_1_1ho4_d_array.html">ho4DArray&lt;T&gt;</a> convKerFlip(convKRO, convKE1, srcCHA, dstCHA);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a>(&amp;convKerFlip);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">for</span> ( ke1=0; ke1&lt;convKE1; ke1++ )</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">for</span> ( kro=0; kro&lt;convKRO; kro++ )</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                    <span class="keywordflow">for</span> ( src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        convKerFlip( kro, ke1, src, dst) = conKerMean(convKRO-1-kro, convKE1-1-ke1, src, dst, 0, 0);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="comment">// minus I</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">if</span> ( minusI )</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                T value = convKerFlip(kRO -1, kE1 -1, dst, dst);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                convKerFlip(kRO -1, kE1 -1, dst, dst) = value - T(1.0);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::scal( (<span class="keyword">typename</span> <a class="code" href="struct_gadgetron_1_1real_type.html">realType&lt;T&gt;::Type</a>)( std::sqrt((<span class="keywordtype">double</span>)(ro*e1)) ), convKerFlip ));</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#adf7278e32e2e0fb4426cf6fa7a79ccc6">Gadgetron::pad</a>(ro, e1, &amp;convKerFlip, &amp;kIm));</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_f_f_t.html">Gadgetron::hoNDFFT&lt;typename realType&lt;T&gt;::Type</a>&gt;::instance()-&gt;ifft2c(kIm);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::imageDomainKernel(...) ... &quot;</span>);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">gtPlusSPIRIT&lt;T&gt;::</a></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">calib3D</a>(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho4_d_array.html">ho4DArray&lt;T&gt;</a>&amp; acsSrc, <span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho4_d_array.html">ho4DArray&lt;T&gt;</a>&amp; acsDst, <span class="keywordtype">double</span> thres, <span class="keywordtype">double</span> overDetermineRatio, </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; ker)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;{</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        GADGET_CHECK_RETURN_FALSE(acsSrc.get_size(0)==acsDst.get_size(0));</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        GADGET_CHECK_RETURN_FALSE(acsSrc.get_size(1)==acsDst.get_size(1));</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        GADGET_CHECK_RETURN_FALSE(acsSrc.get_size(2)==acsDst.get_size(2));</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        GADGET_CHECK_RETURN_FALSE(acsSrc.get_size(3)&gt;=acsDst.get_size(3));</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordtype">size_t</span> RO = acsSrc.get_size(0);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordtype">size_t</span> E1 = acsSrc.get_size(1);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordtype">size_t</span> E2 = acsSrc.get_size(2);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordtype">size_t</span> srcCHA = acsSrc.get_size(3);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordtype">size_t</span> dstCHA = acsDst.get_size(3);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kROhalf = kRO/2;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">if</span> ( 2*kROhalf == kRO )</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - 2*kROhalf == kRO &quot;</span> &lt;&lt; kRO);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        kRO = 2*kROhalf + 1;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kE1half = kE1/2;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">if</span> ( 2*kE1half == kE1 )</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - 2*kE1half == kE1 &quot;</span> &lt;&lt; kE1);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        }</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        kE1 = 2*kE1half + 1;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kE2half = kE2/2;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">if</span> ( 2*kE2half == kE2 )</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - 2*kE2half == kE2 &quot;</span> &lt;&lt; kE2);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        kE2 = 2*kE2half + 1;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">if</span> ( oRO &gt; kRO ) oRO = kRO;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> ( oE1 &gt; kE1 ) oE1 = kE1;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">if</span> ( oE2 &gt; kE2 ) oE2 = kE2;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oROhalf = oRO/2;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">if</span> ( 2*oROhalf == oRO )</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - 2*oROhalf == oRO &quot;</span> &lt;&lt; oRO);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        oRO = 2*oROhalf + 1;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oE1half = oE1/2;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">if</span> ( 2*oE1half == oE1 )</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - 2*oE1half == oE1 &quot;</span> &lt;&lt; oE1);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        oE1 = 2*oE1half + 1;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oE2half = oE2/2;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> ( 2*oE2half == oE2 )</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - 2*oE2half == oE2 &quot;</span> &lt;&lt; oE2);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        oE2 = 2*oE2half + 1;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment">// allocate kernel</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        ker.create(kRO, kE1, kE2, srcCHA, dstCHA, oRO, oE1, oE2);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="comment">// loop over the calibration region and assemble the equation</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="comment">// Ax = b</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordtype">size_t</span> sRO = kROhalf;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordtype">size_t</span> eRO = RO - kROhalf -1;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keywordtype">size_t</span> lenRO = eRO-sRO+1;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordtype">size_t</span> sE1 = kE1half;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordtype">size_t</span> eE1 = E1 - kE1half -1;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordtype">size_t</span> lenE1 = eE1-sE1+1;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordtype">size_t</span> sE2 = kE2half;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordtype">size_t</span> eE2 = E2 - kE2half -1;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordtype">size_t</span> lenE2 = eE2-sE2+1;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordtype">size_t</span> colA = (kRO*kE1*kE2-1)*srcCHA;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> ( overDetermineRatio &gt; 1.0 )</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordtype">size_t</span> maxRowA = (size_t)std::ceil(overDetermineRatio*colA);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordtype">size_t</span> maxROUsed = maxRowA/(lenE1*lenE2);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">if</span> ( maxROUsed &lt; lenRO )</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <span class="comment">// find the peak signal of acsSrc</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                hoNDArray&lt;T&gt; acsSrc1stCha(RO, E1, E2, const_cast&lt;T*&gt;(acsSrc.begin()));</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                hoNDArray&lt;T&gt; acsSrc1stChaSumE2(RO, E1, 1), acsSrc1stChaSumE2E1(RO, 1, 1);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                <span class="keywordflow">try</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    <a class="code" href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a>(acsSrc1stCha, acsSrc1stChaSumE2, 2);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                    <a class="code" href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a>(acsSrc1stChaSumE2, acsSrc1stChaSumE2E1, 1);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    T maxSignal;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    <span class="keywordtype">size_t</span> roInd(0);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                    {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                        <a class="code" href="namespace_gadgetron.html#a4823323aa54566547c51e5ea9d2f45a1">Gadgetron::maxAbsolute</a>(acsSrc1stChaSumE2E1, maxSignal, roInd);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                        <span class="keywordflow">if</span> ( roInd &gt; maxROUsed/2+kROhalf )</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                        {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                            sRO = roInd - maxROUsed/2;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                        }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                        {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                            sRO = kROhalf;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                        }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                        <span class="keywordflow">if</span>( sRO+maxROUsed-1 &lt;= RO-kROhalf-1 )</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                        {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                            eRO = sRO + maxROUsed - 1;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                        }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                            eRO = RO - kROhalf -1;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                        }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                        lenRO = eRO-sRO+1;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        GDEBUG_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - overDetermineRatio = &quot;</span> &lt;&lt; overDetermineRatio &lt;&lt; <span class="stringliteral">&quot; ; RO data range used : [&quot;</span> &lt;&lt; sRO &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; eRO &lt;&lt; <span class="stringliteral">&quot;] ...&quot;</span>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                    }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    {</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                        GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - overDetermineRatio is ignored ... &quot;</span>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                        <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                    }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="keywordflow">catch</span> (...)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    GWARN_STREAM(<span class="stringliteral">&quot;gtPlusSPIRIT&lt;T&gt;::calib3D(...) - overDetermineRatio is ignored ... &quot;</span>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    <span class="keywordflow">throw</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordtype">size_t</span> rowA = lenRO*lenE1*lenE2;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="keywordtype">size_t</span> colB = dstCHA;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordtype">bool</span> useGPU = (<span class="keyword">typeid</span>(<span class="keyword">typename</span> realType&lt;T&gt;::Type)==<span class="keyword">typeid</span>(<span class="keywordtype">float</span>) &amp;&amp; calib_use_gpu_);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">if</span> ( useGPU )</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            GDEBUG_STREAM(<span class="stringliteral">&quot;spirit 3D - calling GPU kernel estimation ... &quot;</span>);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor">        #pragma omp parallel default(none) shared(sRO, eRO, sE1, eE1, sE2, eE2, oRO, oE1, oE2, lenRO, lenE1, lenE2, rowA, colA, colB, kROhalf, kE1half, kE2half, oROhalf, oE1half, oE2half, acsSrc, acsDst, srcCHA, dstCHA, thres, ker, useGPU, std::cout) num_threads( (int)(oRO*oE1*oE2) ) if (oRO*oE1*oE2&gt;=3 &amp;&amp; oRO*oE1*oE2&lt;9)</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor"></span>        {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            hoMatrix&lt;T&gt; A(rowA, colA);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            hoMatrix&lt;T&gt; B(rowA, colB);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            hoMatrix&lt;T&gt; x( A.cols(), B.cols() );</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            T* pA = A.begin();</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            T* pB = B.begin();</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordtype">long</span> <span class="keywordtype">long</span> kInd = 0;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="preprocessor">            #pragma omp for</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">for</span> ( kInd=0; kInd&lt;(<span class="keywordtype">long</span> long)(oRO*oE1*oE2); kInd++ )</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> oe2 = kInd/(oRO*oE1);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> oe1 = kInd - oe2*oRO*oE1;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                oe1 /= oRO;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> oro = kInd - oe2*oRO*oE1 - oe1*oRO;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                oe2 -=oE2half;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                oe1 -=oE1half;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                oro -=oROhalf;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> dRO, dE1, dE2;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> e2=(<span class="keywordtype">long</span> <span class="keywordtype">long</span>)sE2; e2&lt;=(<span class="keywordtype">long</span> long)eE2; e2++ )</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                    dE2 = e2 + oe2;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                    <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> e1=(<span class="keywordtype">long</span> <span class="keywordtype">long</span>)sE1; e1&lt;=(<span class="keywordtype">long</span> long)eE1; e1++ )</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                        dE1 = e1 + oe1;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ro=sRO; ro&lt;=(<span class="keywordtype">long</span> long)eRO; ro++ )</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                        {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                            dRO = ro + oro;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                            <span class="keywordtype">long</span> <span class="keywordtype">long</span> rInd = (e2-sE2)*lenRO*lenE1 + (e1-sE1)*lenRO + ro-sRO;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                            <span class="comment">// fill matrix A</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                            <span class="keywordtype">size_t</span> col = 0;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                            <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                            {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ke2=-kE2half; ke2&lt;=kE2half; ke2++ )</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                    <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ke1=-kE1half; ke1&lt;=kE1half; ke1++ )</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                    {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                                        <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> kro=-kROhalf; kro&lt;=kROhalf; kro++ )</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                        {</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                                            <span class="keywordflow">if</span> ( kro!=oro || ke1!=oe1 || ke2!=oe2 )</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                            {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                                                <span class="comment">//A(rInd, col++) = acsSrc(ro+kro, e1+ke1, e2+ke2, src);</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                                                pA[rInd+col*rowA] = acsSrc(ro+kro, e1+ke1, e2+ke2, src);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                                                col++;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                            }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                        }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                    }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                            }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                            <span class="comment">// fill matrix B</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                            <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                            {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                                <span class="comment">//B(rInd, dst) = acsDst(dRO, dE1, dE2, dst);</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                pB[rInd+dst*rowA] = acsDst(dRO, dE1, dE2, dst);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                            }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                        }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="comment">//GADGET_CHECK_RETURN_FALSE(SolveLinearSystem_Tikhonov(A, B, x, thres));</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                <span class="comment">//if ( performTiming_ ) { gt_timer3_.start(&quot;grappa 3D calibration - solve linear system ... &quot;); }</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <span class="comment">//#ifdef USE_CUDA</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                <span class="comment">//    // go to device</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                <span class="comment">//    try</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <span class="comment">//    {</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                <span class="comment">//        if ( useGPU )</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                <span class="comment">//        {</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="comment">//            hoNDArray&lt;float_complext&gt; A_tmp(A.get_dimensions(), reinterpret_cast&lt;float_complext*&gt;(A.begin()));</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                <span class="comment">//            hoNDArray&lt;float_complext&gt; B_tmp(B.get_dimensions(), reinterpret_cast&lt;float_complext*&gt;(B.begin()));</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="comment">//            int ret(0);</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="comment">//            boost::shared_ptr&lt; hoNDArray&lt;complext&lt;float&gt; &gt; &gt; host_x;</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="comment">//            #pragma omp critical(inverse_spirit3D)</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                <span class="comment">//            {</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                <span class="comment">//                cuNDArray&lt;float_complext&gt; device_A(A_tmp);</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                <span class="comment">//                cuNDArray&lt;float_complext&gt; device_B(B_tmp);</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                <span class="comment">//                cuNDArray&lt;float_complext&gt; device_x;</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                <span class="comment">//                ret = Gadgetron::inverse_clib_matrix(&amp;device_A, &amp;device_B, &amp;device_x, thres);</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                <span class="comment">//                if ( ret == 0 )</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                <span class="comment">//                {</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                <span class="comment">//                    host_x = device_x.to_host();</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                <span class="comment">//                }</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                <span class="comment">//            }</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                <span class="comment">//            if ( ret != 0 )</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                <span class="comment">//            {</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                <span class="comment">//                GERROR_STREAM(&quot;failed in Gadgetron::inverse_clib_matrix(&amp;device_A, &amp;device_B, &amp;device_x, thres) ... &quot;);</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <span class="comment">//                SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <span class="comment">//            }</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <span class="comment">//            else</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="comment">//            {</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                <span class="comment">//                memcpy(x.begin(), host_x-&gt;begin(), x.get_number_of_bytes());</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                <span class="comment">//            }</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="comment">//        }</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                <span class="comment">//        else</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                <span class="comment">//        {</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <span class="comment">//            GWARN_STREAM(&quot;GPU inverse_clib_matrix is only available for single-precision, calling the CPU version ... &quot;);</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                <span class="comment">//            SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                <span class="comment">//        }</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                <span class="comment">//    }</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <span class="comment">//    catch(...)</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="comment">//    {</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                <span class="comment">//        GERROR_STREAM(&quot;failed in GPU inverse_clib_matrix for grappa, calling the CPU version ... &quot;);</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                <span class="comment">//        SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                <span class="comment">//    }</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                <span class="comment">//#else</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                    <a class="code" href="namespace_gadgetron.html#aa27c6f79324f87af705a03bdee309cc4">SolveLinearSystem_Tikhonov</a>(A, B, x, thres);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                <span class="comment">//#endif // USE_CUDA</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                <span class="comment">//if ( performTiming_ ) { gt_timer3_.stop(); }</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                <span class="comment">// SolveLinearSystem_Tikhonov(A, B, x, thres);</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> ind(0);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                std::vector&lt;size_t&gt; kerInd(8);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                kerInd[7] = oe2+oE2half;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                kerInd[6] = oe1+oE1half;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                kerInd[5] = oro+oROhalf;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                    kerInd[3] = src;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ke2=-kE2half; ke2&lt;=kE2half; ke2++ ) </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                    {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                        kerInd[2] = ke2+kE2half;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> ke1=-kE1half; ke1&lt;=kE1half; ke1++ ) </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                        {</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                            kerInd[1] = ke1+kE1half;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                            <span class="keywordflow">for</span> ( <span class="keywordtype">long</span> <span class="keywordtype">long</span> kro=-kROhalf; kro&lt;=kROhalf; kro++ ) </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                            {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                                kerInd[0] = kro+kROhalf;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                                <span class="keywordflow">if</span> ( kro!=0 || ke1!=0 || ke2!=0 )</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                                {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                                    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                                    {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                                        kerInd[4] = dst;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                                        <span class="keywordtype">size_t</span> offset = ker.calculate_offset(kerInd);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                                        ker(offset) = x(ind, dst);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                                    }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                    ind++;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                                }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                                {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                                    <span class="keywordflow">for</span> ( <span class="keywordtype">size_t</span> dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                    {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                        kerInd[4] = dst;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                        <span class="keywordtype">size_t</span> offset = ker.calculate_offset(kerInd);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                        ker(offset) = 0;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                                    }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                                }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                            }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                        }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                    }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::calib3D(...) ... &quot;</span>);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;}</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#a511dda6e65a571935534cc264f8d3ae9">gtPlusSPIRIT&lt;T&gt;::</a></div>
<div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#a511dda6e65a571935534cc264f8d3ae9">  772</a></span>&#160;<a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#a511dda6e65a571935534cc264f8d3ae9">kspaceDomainConvKernel3D</a>(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <a class="code" href="class_gadgetron_1_1ho5_d_array.html">ho5DArray&lt;T&gt;</a>&amp; convKerFlip, <span class="keywordtype">bool</span> minusI, <span class="keywordtype">bool</span> ROis3rdDim)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;{</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> srcCHA = (<span class="keywordtype">long</span> long)(ker.get_size(3));</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> dstCHA = (<span class="keywordtype">long</span> long)(ker.get_size(4));</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        GADGET_CHECK_RETURN_FALSE(kRO==ker.get_size(0));</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        GADGET_CHECK_RETURN_FALSE(kE1==ker.get_size(1));</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        GADGET_CHECK_RETURN_FALSE(kE2==ker.get_size(2));</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        GADGET_CHECK_RETURN_FALSE(oRO==ker.get_size(5));</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        GADGET_CHECK_RETURN_FALSE(oE1==ker.get_size(6));</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        GADGET_CHECK_RETURN_FALSE(oE2==ker.get_size(7));</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kROhalf = kRO/2;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kE1half = kE1/2;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> kE2half = kE2/2;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oROhalf = oRO/2;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oE1half = oE1/2;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oE2half = oE2/2;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> convKRO = 2*kRO-1;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> convKE1 = 2*kE1-1;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> convKE2 = 2*kE2-1;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - convert to conv kernel ... &quot;</span>); }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a> convKer(convKRO, convKE1, convKE2, srcCHA, dstCHA, oRO, oE1, oE2);</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <a class="code" href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a>(&amp;convKer);</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> oro, oe1, oe2, kro, ke1, ke2, src, dst;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        std::vector&lt;size_t&gt; kerInd(8), convKerInd(8);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">for</span> ( oe2=-oE2half; oe2&lt;=oE2half; oe2++ )</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            kerInd[7] = oe2+oE2half;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            convKerInd[7] = oe2+oE2half;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <span class="keywordflow">for</span> ( oe1=-oE1half; oe1&lt;=oE1half; oe1++ )</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                kerInd[6] = oe1+oE1half;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                convKerInd[6] = oe1+oE1half;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                <span class="keywordflow">for</span> ( oro=-oROhalf; oro&lt;=oROhalf; oro++ )</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    kerInd[5] = oro+oROhalf;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                    convKerInd[5] = oro+oROhalf;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    <span class="keywordflow">for</span> ( ke2=-kE2half; ke2&lt;=kE2half; ke2++ )</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                    {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                        kerInd[2] = ke2+kE2half;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                        <span class="keywordflow">for</span> ( ke1=-kE1half; ke1&lt;=kE1half; ke1++ )</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                        {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                            kerInd[1] = ke1+kE1half;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                            <span class="keywordflow">for</span> ( kro=-kROhalf; kro&lt;=kROhalf; kro++ )</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                            {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                                <span class="keywordtype">long</span> <span class="keywordtype">long</span> iro = kro - oro + kRO -1;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                <span class="keywordtype">long</span> <span class="keywordtype">long</span> ie1 = ke1 - oe1 + kE1 -1;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                                <span class="keywordtype">long</span> <span class="keywordtype">long</span> ie2 = ke2 - oe2 + kE2 -1;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                                kerInd[0] = kro+kROhalf;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                                convKerInd[0] = iro;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                                convKerInd[1] = ie1;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                                convKerInd[2] = ie2;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                                <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                                {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                                    kerInd[4] = dst;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                    convKerInd[4] = dst;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                    <span class="keywordflow">for</span> ( src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                    {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                                        kerInd[3] = src;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                        convKerInd[3] = src;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                                        <span class="keywordtype">size_t</span> offsetKer = ker.calculate_offset(kerInd);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                                        <span class="keywordtype">size_t</span> offsetConvKer = convKer.calculate_offset(convKerInd);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                                        convKer(offsetConvKer) = ker(offsetKer);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                                    }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                                }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                            }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                        }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                    }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                }</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            }</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        }</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - sum over output dimensions ... &quot;</span>); }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a> convKer2, convKer3;</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="comment">//ho5DArray&lt;T&gt; convKernMean(convKRO, convKE1, convKE2, srcCHA, dstCHA);</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="comment">//GADGET_CHECK_RETURN_FALSE(Gadgetron::sumOverLastDimension(convKer, convKer2));</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="comment">//GADGET_CHECK_RETURN_FALSE(Gadgetron::sumOverLastDimension(convKer2, convKer3));</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="comment">//GADGET_CHECK_RETURN_FALSE(Gadgetron::sumOverLastDimension(convKer3, convKernMean));</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a> convKernMean(convKRO, convKE1, convKE2, srcCHA, dstCHA, 1, 1, 1);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a>(convKer, convKer2, 7));</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a>(convKer2, convKer3, 6));</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a>(convKer3, convKernMean, 5));</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::scal( (<span class="keyword">typename</span> <a class="code" href="struct_gadgetron_1_1real_type.html">realType&lt;T&gt;::Type</a>)(1.0/(oRO*oE1*oE2)), convKernMean) );</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - flip along dimensions ... &quot;</span>); }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(convKernMean, debugFolder_+<span class="stringliteral">&quot;convKernMean&quot;</span>); }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="comment">// flip the kernel</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordflow">if</span> ( ROis3rdDim ) <span class="comment">// E1, E2, RO</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            convKerFlip.createArray(convKE1, convKE2, convKRO, srcCHA, dstCHA);</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <a class="code" href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a>(&amp;convKerFlip);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="keywordflow">for</span> ( ke2=0; ke2&lt;convKE2; ke2++ )</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                <span class="keywordflow">for</span> ( ke1=0; ke1&lt;convKE1; ke1++ )</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                    <span class="keywordflow">for</span> ( kro=0; kro&lt;convKRO; kro++ )</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                    {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                        <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                        {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                            <span class="keywordflow">for</span> ( src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                            {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                T value = convKernMean(convKRO-1-kro, convKE1-1-ke1, convKE2-1-ke2, src, dst, 0, 0, 0);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                convKerFlip(ke1, ke2, kro, src, dst) = value;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                            }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                        }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                    }</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(convKerFlip, debugFolder_+<span class="stringliteral">&quot;convKerFlip&quot;</span>); }</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="comment">// minus I</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <span class="keywordflow">if</span> ( minusI )</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                {</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                    T value = convKerFlip(kE1 -1, kE2 -1, kRO -1, dst, dst);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                    convKerFlip(kE1 -1, kE2 -1, kRO -1, dst, dst) = value - T(1.0);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(convKerFlip, debugFolder_+<span class="stringliteral">&quot;convKerFlip_minusI&quot;</span>); }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="comment">// RO, E1, E2</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            convKerFlip.createArray(convKRO, convKE1, convKE2, srcCHA, dstCHA);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <a class="code" href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a>(&amp;convKerFlip);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="keywordflow">for</span> ( ke2=0; ke2&lt;convKE2; ke2++ )</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            {</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                <span class="keywordflow">for</span> ( ke1=0; ke1&lt;convKE1; ke1++ )</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                    <span class="keywordflow">for</span> ( kro=0; kro&lt;convKRO; kro++ )</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                    {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                        <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                        {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                            <span class="keywordflow">for</span> ( src=0; src&lt;srcCHA; src++ )</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                            {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                                T value = convKernMean(convKRO-1-kro, convKE1-1-ke1, convKE2-1-ke2, src, dst);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                                convKerFlip(kro, ke1, ke2, src, dst) = value;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                            }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                        }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                    }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                }</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(convKerFlip, debugFolder_+<span class="stringliteral">&quot;convKerFlip&quot;</span>); }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="comment">// minus I</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="keywordflow">if</span> ( minusI )</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                <span class="keywordflow">for</span> ( dst=0; dst&lt;dstCHA; dst++ )</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                    T value = convKerFlip(kRO -1, kE1 -1, kE2 -1, dst, dst);</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                    convKerFlip(kRO -1, kE1 -1, kE2 -1, dst, dst) = value - T(1.0);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(convKerFlip, debugFolder_+<span class="stringliteral">&quot;convKerFlip_minusI&quot;</span>); }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::kspaceDomainConvKernel3D(...) ... &quot;</span>);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;}</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">gtPlusSPIRIT&lt;T&gt;::</a></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<a class="code" href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">imageDomainKernel3D</a>(<span class="keyword">const</span> <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <span class="keywordtype">size_t</span> ro, <span class="keywordtype">size_t</span> e1, <span class="keywordtype">size_t</span> e2, <a class="code" href="class_gadgetron_1_1ho_n_d_array.html">hoNDArray&lt;T&gt;</a>&amp; kIm, <span class="keywordtype">bool</span> minusI)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> srcCHA = (<span class="keywordtype">long</span> long)(ker.get_size(3));</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> dstCHA = (<span class="keywordtype">long</span> long)(ker.get_size(4));</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        GADGET_CHECK_RETURN_FALSE(kRO==ker.get_size(0));</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        GADGET_CHECK_RETURN_FALSE(kE1==ker.get_size(1));</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        GADGET_CHECK_RETURN_FALSE(kE2==ker.get_size(2));</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        GADGET_CHECK_RETURN_FALSE(oRO==ker.get_size(5));</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        GADGET_CHECK_RETURN_FALSE(oE1==ker.get_size(6));</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        GADGET_CHECK_RETURN_FALSE(oE2==ker.get_size(7));</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="comment">// allocate image domain kernel</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        kIm.create(e1, e2, ro, srcCHA, dstCHA);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordtype">bool</span> ROat3rdDim = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <a class="code" href="class_gadgetron_1_1ho5_d_array.html">ho5DArray&lt;T&gt;</a> convKerFlip;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        GADGET_CHECK_RETURN_FALSE(this-&gt;kspaceDomainConvKernel3D(ker, kRO, kE1,  kE2, oRO, oE1, oE2, convKerFlip, minusI, ROat3rdDim));</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - SNR unit scaling ... &quot;</span>); }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::scal( (<span class="keyword">typename</span> <a class="code" href="struct_gadgetron_1_1real_type.html">realType&lt;T&gt;::Type</a>)( std::sqrt((<span class="keywordtype">double</span>)(ro*e1*e2)) ), convKerFlip ));</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(convKerFlip, debugFolder_+<span class="stringliteral">&quot;convKerFlip_scal&quot;</span>); }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - zero padding ... &quot;</span>); }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="comment">// GADGET_CHECK_RETURN_FALSE(gtPlusISMRMRDReconUtil&lt;T&gt;().zeropad3D(convKerFlip, e1, e2, ro, kIm));</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="comment">// GADGET_CHECK_RETURN_FALSE(gtPlusISMRMRDReconUtil&lt;T&gt;().zeropad3DNoPresetZeros(convKerFlip, e1, e2, ro, kIm));</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="comment">// GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::zeropad3D(convKerFlip, e1, e2, ro, kIm, false));</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#adf7278e32e2e0fb4426cf6fa7a79ccc6">Gadgetron::pad</a>(e1, e2, ro, &amp;convKerFlip, &amp;kIm, <span class="keyword">false</span>));</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(kIm, debugFolder_+<span class="stringliteral">&quot;convKerFlip_scal_zeropadded&quot;</span>); }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - conver to image domain ... &quot;</span>); }</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> n;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="preprocessor">        #pragma omp parallel default(none) private(n) shared(ro, e1, e2, srcCHA, dstCHA, kIm)</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="preprocessor"></span>        {</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            hoNDArray&lt;T&gt; kImTmp(ro, e1, e2);</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            hoNDArray&lt;T&gt; kImRes(ro, e1, e2);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="preprocessor">            #pragma omp for </span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">for</span> (n = 0; n &lt; srcCHA*dstCHA; n++)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> d = n / srcCHA;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">long</span> s = n - d*srcCHA;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                T* pkImCha = kIm.begin() + d*ro*e1*e2*srcCHA + s*ro*e1*e2;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                hoNDArray&lt;T&gt; kImCha(ro, e1, e2, pkImCha);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                <a class="code" href="class_gadgetron_1_1ho_n_d_f_f_t.html">Gadgetron::hoNDFFT&lt;typename realType&lt;T&gt;::Type</a>&gt;::instance()-&gt;ifft3c(kImCha, kImRes, kImTmp);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                memcpy(pkImCha, kImRes.begin(), kImRes.get_number_of_bytes());</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            }</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::imageDomainKernel3D(...) ... &quot;</span>);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;}</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="keywordtype">bool</span> gtPlusSPIRIT&lt;T&gt;::</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;imageDomainKernelRO3D(<span class="keyword">const</span> hoNDArray&lt;T&gt;&amp; ker, <span class="keywordtype">size_t</span> kRO, <span class="keywordtype">size_t</span> kE1, <span class="keywordtype">size_t</span> kE2, <span class="keywordtype">size_t</span> oRO, <span class="keywordtype">size_t</span> oE1, <span class="keywordtype">size_t</span> oE2, <span class="keywordtype">size_t</span> ro, hoNDArray&lt;T&gt;&amp; kImRO, <span class="keywordtype">bool</span> minusI)</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;{</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> srcCHA = (<span class="keywordtype">long</span> long)(ker.get_size(3));</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordtype">long</span> <span class="keywordtype">long</span> dstCHA = (<span class="keywordtype">long</span> long)(ker.get_size(4));</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        GADGET_CHECK_RETURN_FALSE(kRO==ker.get_size(0));</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        GADGET_CHECK_RETURN_FALSE(kE1==ker.get_size(1));</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        GADGET_CHECK_RETURN_FALSE(kE2==ker.get_size(2));</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        GADGET_CHECK_RETURN_FALSE(oRO==ker.get_size(5));</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        GADGET_CHECK_RETURN_FALSE(oE1==ker.get_size(6));</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        GADGET_CHECK_RETURN_FALSE(oE2==ker.get_size(7));</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordtype">bool</span> ROat3rdDim = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        ho5DArray&lt;T&gt; convKerFlip;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        GADGET_CHECK_RETURN_FALSE(this-&gt;kspaceDomainConvKernel3D(ker, kRO, kE1,  kE2, oRO, oE1, oE2, convKerFlip, minusI, ROat3rdDim));</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="comment">// allocate image domain kernel</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="keywordtype">size_t</span> kConvE1 = convKerFlip.get_size(1);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="keywordtype">size_t</span> kConvE2 = convKerFlip.get_size(2);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        kImRO.create(kConvE1, kConvE2, ro, srcCHA, dstCHA);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        hoNDArray&lt;T&gt; kImROTemp(ro, kConvE1, kConvE2, srcCHA, dstCHA);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <a class="code" href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a>(kImROTemp);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - SNR unit scaling ... &quot;</span>); }</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::scal( (<span class="keyword">typename</span> realType&lt;T&gt;::Type)( std::sqrt((<span class="keywordtype">double</span>)(ro)) ), convKerFlip ));</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(convKerFlip, debugFolder_+<span class="stringliteral">&quot;convKerFlip_scal_RO&quot;</span>); }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - zero padding only for RO ... &quot;</span>); }</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="comment">// GADGET_CHECK_RETURN_FALSE(gtPlusISMRMRDReconUtil&lt;T&gt;().zeropad3DNoPresetZeros(convKerFlip, ro, kConvE1, kConvE2, kImROTemp));</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <span class="comment">// GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::zeropad3D(convKerFlip, ro, kConvE1, kConvE2, kImROTemp, false));</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#adf7278e32e2e0fb4426cf6fa7a79ccc6">Gadgetron::pad</a>(ro, kConvE1, kConvE2, &amp;convKerFlip, &amp;kImROTemp, <span class="keyword">false</span>));</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(kImROTemp, debugFolder_+<span class="stringliteral">&quot;convKerFlip_scal_RO_zeropadded&quot;</span>); }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - conver to image domain only for RO ... &quot;</span>); }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_f_f_t.html">Gadgetron::hoNDFFT&lt;typename realType&lt;T&gt;::Type</a>&gt;::instance()-&gt;ifft1c(kImROTemp);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - permute kernel dimensions to be [kE1 kE2 RO ...]  ... &quot;</span>); }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        std::vector&lt;size_t&gt; dim_order(3);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        dim_order[0] = 1;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        dim_order[1] = 2;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        dim_order[2] = 0;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::permute(&amp;kImROTemp, &amp;kImRO, &amp;dim_order));</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    {</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::imageDomainKernelRO3D(...) ... &quot;</span>);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    }</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="keywordtype">bool</span> gtPlusSPIRIT&lt;T&gt;::</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;imageDomainKernelE1E2RO(<span class="keyword">const</span> hoNDArray&lt;T&gt;&amp; kImRO, <span class="keywordtype">size_t</span> e1, <span class="keywordtype">size_t</span> e2, hoNDArray&lt;T&gt;&amp; kImE1E2RO)</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;{</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    {</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        boost::shared_ptr&lt; std::vector&lt;size_t&gt; &gt; dim = kImRO.get_dimensions();</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        std::vector&lt;size_t&gt; dimR(*dim);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        dimR[0] = e1;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        dimR[1] = e2;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        kImE1E2RO.create(&amp;dimR);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <a class="code" href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a>(kImE1E2RO);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        hoNDArray&lt;T&gt; kImROScaled(kImRO);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - SNR unit scaling for E1 and E2 ... &quot;</span>); }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::scal( (<span class="keyword">typename</span> realType&lt;T&gt;::Type)( std::sqrt((<span class="keywordtype">double</span>)(e1*e2)) ), kImROScaled ));</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(kImROScaled, debugFolder_+<span class="stringliteral">&quot;kImROScaledE1E2&quot;</span>); }</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - zero padding for E1 and E2 ... &quot;</span>); }</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="comment">// GADGET_CHECK_RETURN_FALSE(gtPlusISMRMRDReconUtil&lt;T&gt;().zeropad3DNoPresetZeros(kImROScaled, e1, e2, dimR[2], kImE1E2RO));</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <span class="comment">// GADGET_CHECK_EXCEPTION_RETURN_FALSE(Gadgetron::zeropad3D(kImROScaled, e1, e2, dimR[2], kImE1E2RO, false));</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        GADGET_CHECK_EXCEPTION_RETURN_FALSE(<a class="code" href="namespace_gadgetron.html#adf7278e32e2e0fb4426cf6fa7a79ccc6">Gadgetron::pad</a>(e1, e2, dimR[2], &amp;kImROScaled, &amp;kImE1E2RO, <span class="keyword">false</span>));</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="keywordflow">if</span> ( !debugFolder_.empty() ) { gt_exporter_.exportArrayComplex(kImE1E2RO, debugFolder_+<span class="stringliteral">&quot;kImE1E2RO_zeropadded_E1E2&quot;</span>); }</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.start(<span class="stringliteral">&quot;spirit 3D calibration - conver to image domain for E1 and E2 ... &quot;</span>); }</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <a class="code" href="class_gadgetron_1_1ho_n_d_f_f_t.html">Gadgetron::hoNDFFT&lt;typename realType&lt;T&gt;::Type</a>&gt;::instance()-&gt;ifft2c(kImE1E2RO);</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        <span class="keywordflow">if</span> ( performTiming_ ) { gt_timer3_.stop(); }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::imageDomainKernelE1E2RO(...) ... &quot;</span>);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    }</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;}</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="keywordtype">bool</span> gtPlusSPIRIT&lt;T&gt;::</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;imageDomainAdjointKernel(<span class="keyword">const</span> hoNDArray&lt;T&gt;&amp; kIm, hoNDArray&lt;T&gt;&amp; adjkIm)</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;{</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <a class="code" href="namespace_gadgetron.html#ac91d9cf88dbefd0c439359fc03f91235">Gadgetron::spirit_image_domain_adjoint_kernel</a>(kIm, adjkIm);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::imageDomainAdjointKernel(...) ... &quot;</span>);</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    }</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;}</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="keywordtype">bool</span> gtPlusSPIRIT&lt;T&gt;::AdjointForwardKernel(<span class="keyword">const</span> hoNDArray&lt;T&gt;&amp; kImS2D, <span class="keyword">const</span> hoNDArray&lt;T&gt;&amp; kImD2S, hoNDArray&lt;T&gt;&amp; kIm)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;{</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    {</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <a class="code" href="namespace_gadgetron.html#a65a1d7d0f81cce576934d6a0d4c5a9d3">Gadgetron::spirit_adjoint_forward_kernel</a>(kImS2D, kImD2S, kIm);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    }</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">catch</span>(...)</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    {</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        GERROR_STREAM(<span class="stringliteral">&quot;Errors in gtPlusSPIRIT&lt;T&gt;::AdjointForwardKernel(...) ... &quot;</span>);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    }</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;}</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;}}</div>
<div class="ttc" id="namespace_gadgetron_html_aa27c6f79324f87af705a03bdee309cc4"><div class="ttname"><a href="namespace_gadgetron.html#aa27c6f79324f87af705a03bdee309cc4">Gadgetron::SolveLinearSystem_Tikhonov</a></div><div class="ttdeci">void SolveLinearSystem_Tikhonov(hoNDArray&lt; T &gt; &amp;A, hoNDArray&lt; T &gt; &amp;b, hoNDArray&lt; T &gt; &amp;x, double lamda)</div><div class="ttdoc">solve Ax=b with Tikhonov regularization </div></div>
<div class="ttc" id="struct_gadgetron_1_1real_type_html"><div class="ttname"><a href="struct_gadgetron_1_1real_type.html">Gadgetron::realType</a></div><div class="ttdef"><b>Definition:</b> complext.h:163</div></div>
<div class="ttc" id="class_gadgetron_1_1ho_n_d_f_f_t_html"><div class="ttname"><a href="class_gadgetron_1_1ho_n_d_f_f_t.html">Gadgetron::hoNDFFT</a></div><div class="ttdef"><b>Definition:</b> hoNDFFT.h:44</div></div>
<div class="ttc" id="namespace_gadgetron_html_aaa657ae09c5ee05e5a5ba71c57fb0243"><div class="ttname"><a href="namespace_gadgetron.html#aaa657ae09c5ee05e5a5ba71c57fb0243">Gadgetron::clear</a></div><div class="ttdeci">void clear(hoNDArray&lt; T &gt; *x)</div><div class="ttdoc">Clears the array to all zeros ( in place). Faster than fill. </div><div class="ttdef"><b>Definition:</b> hoNDArray_elemwise.h:394</div></div>
<div class="ttc" id="namespace_gadgetron_html_adf7278e32e2e0fb4426cf6fa7a79ccc6"><div class="ttname"><a href="namespace_gadgetron.html#adf7278e32e2e0fb4426cf6fa7a79ccc6">Gadgetron::pad</a></div><div class="ttdeci">void pad(const typename uint64d&lt; D &gt;::Type &amp;size, hoNDArray&lt; T &gt; *in, hoNDArray&lt; T &gt; *out, bool preset_out_with_val=true, T val=T(0))</div><div class="ttdef"><b>Definition:</b> hoNDArray_utils.h:413</div></div>
<div class="ttc" id="namespace_gadgetron_html_a326e5f465754761d8945b29f751d870b"><div class="ttname"><a href="namespace_gadgetron.html#a326e5f465754761d8945b29f751d870b">Gadgetron::sum_over_dimension</a></div><div class="ttdeci">void sum_over_dimension(const hoNDArray&lt; T &gt; &amp;x, hoNDArray&lt; T &gt; &amp;r, size_t dim)</div><div class="ttdoc">sum over a specific dimension x: input array, y: output array, dim: dimension to perform sum resultin...</div><div class="ttdef"><b>Definition:</b> hoNDArray_elemwise.cpp:2610</div></div>
<div class="ttc" id="gt_plus_algorithm_base_8h_html"><div class="ttname"><a href="gt_plus_algorithm_base_8h.html">gtPlusAlgorithmBase.h</a></div><div class="ttdoc">Base class for GtPlus algorithm. </div></div>
<div class="ttc" id="namespace_gadgetron_html_a65a1d7d0f81cce576934d6a0d4c5a9d3"><div class="ttname"><a href="namespace_gadgetron.html#a65a1d7d0f81cce576934d6a0d4c5a9d3">Gadgetron::spirit_adjoint_forward_kernel</a></div><div class="ttdeci">void spirit_adjoint_forward_kernel(const hoNDArray&lt; T &gt; &amp;kImS2D, const hoNDArray&lt; T &gt; &amp;kImD2S, hoNDArray&lt; T &gt; &amp;kIm)</div><div class="ttdoc">compute the (G-I)&#39;*(G-I) </div><div class="ttdef"><b>Definition:</b> mri_core_spirit.cpp:780</div></div>
<div class="ttc" id="class_gadgetron_1_1ho5_d_array_html"><div class="ttname"><a href="class_gadgetron_1_1ho5_d_array.html">Gadgetron::ho5DArray</a></div><div class="ttdef"><b>Definition:</b> ho5DArray.h:7</div></div>
<div class="ttc" id="class_gadgetron_1_1ho6_d_array_html"><div class="ttname"><a href="class_gadgetron_1_1ho6_d_array.html">Gadgetron::ho6DArray</a></div><div class="ttdef"><b>Definition:</b> ho6DArray.h:7</div></div>
<div class="ttc" id="class_gadgetron_1_1ho3_d_array_html"><div class="ttname"><a href="class_gadgetron_1_1ho3_d_array.html">Gadgetron::ho3DArray</a></div><div class="ttdef"><b>Definition:</b> ho3DArray.h:7</div></div>
<div class="ttc" id="class_gadgetron_1_1ho4_d_array_html"><div class="ttname"><a href="class_gadgetron_1_1ho4_d_array.html">Gadgetron::ho4DArray</a></div><div class="ttdef"><b>Definition:</b> ho4DArray.h:7</div></div>
<div class="ttc" id="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t_html"><div class="ttname"><a href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html">Gadgetron::gtPlus::gtPlusSPIRIT</a></div><div class="ttdef"><b>Definition:</b> gtPlusSPIRIT.h:26</div></div>
<div class="ttc" id="namespace_gadgetron_html_a4823323aa54566547c51e5ea9d2f45a1"><div class="ttname"><a href="namespace_gadgetron.html#a4823323aa54566547c51e5ea9d2f45a1">Gadgetron::maxAbsolute</a></div><div class="ttdeci">void maxAbsolute(const hoNDArray&lt; T &gt; &amp;x, T &amp;r, size_t &amp;ind)</div><div class="ttdoc">ind = max(abs(x(:)) find the miximal absolute value of x and its position index ind r = x[ind]...</div><div class="ttdef"><b>Definition:</b> hoNDArray_math_util.cpp:396</div></div>
<div class="ttc" id="class_gadgetron_1_1ho_n_d_array_html"><div class="ttname"><a href="class_gadgetron_1_1ho_n_d_array.html">Gadgetron::hoNDArray</a></div><div class="ttdef"><b>Definition:</b> hoNDArray.h:20</div></div>
<div class="ttc" id="class_gadgetron_1_1gt_plus_1_1gt_plus_algorithm_base_html"><div class="ttname"><a href="class_gadgetron_1_1gt_plus_1_1gt_plus_algorithm_base.html">Gadgetron::gtPlus::gtPlusAlgorithmBase</a></div><div class="ttdef"><b>Definition:</b> gtPlusAlgorithmBase.h:20</div></div>
<div class="ttc" id="mri__core__spirit_8h_html"><div class="ttname"><a href="mri__core__spirit_8h.html">mri_core_spirit.h</a></div><div class="ttdoc">SPIRIT implementation for 2D and 3D MRI parallel imaging. </div></div>
<div class="ttc" id="namespace_gadgetron_html_ac91d9cf88dbefd0c439359fc03f91235"><div class="ttname"><a href="namespace_gadgetron.html#ac91d9cf88dbefd0c439359fc03f91235">Gadgetron::spirit_image_domain_adjoint_kernel</a></div><div class="ttdeci">void spirit_image_domain_adjoint_kernel(const hoNDArray&lt; T &gt; &amp;kIm, hoNDArray&lt; T &gt; &amp;adjkIm)</div><div class="ttdef"><b>Definition:</b> mri_core_spirit.cpp:736</div></div>
<div class="ttc" id="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t_html_ad566c30ab4e06acbf21830beef6db73e"><div class="ttname"><a href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#ad566c30ab4e06acbf21830beef6db73e">Gadgetron::gtPlus::gtPlusSPIRIT::imageDomainKernel</a></div><div class="ttdeci">bool imageDomainKernel(const ho6DArray&lt; T &gt; &amp;ker, size_t kRO, size_t kE1, size_t oRO, size_t oE1, size_t ro, size_t e1, hoNDArray&lt; T &gt; &amp;kIm, bool minusI=false)</div><div class="ttdef"><b>Definition:</b> gtPlusSPIRIT.h:341</div></div>
<div class="ttc" id="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t_html_a511dda6e65a571935534cc264f8d3ae9"><div class="ttname"><a href="class_gadgetron_1_1gt_plus_1_1gt_plus_s_p_i_r_i_t.html#a511dda6e65a571935534cc264f8d3ae9">Gadgetron::gtPlus::gtPlusSPIRIT::kspaceDomainConvKernel3D</a></div><div class="ttdeci">bool kspaceDomainConvKernel3D(const hoNDArray&lt; T &gt; &amp;ker, size_t kRO, size_t kE1, size_t kE2, size_t oRO, size_t oE1, size_t oE2, ho5DArray&lt; T &gt; &amp;convKerFlip, bool minusI=true, bool ROis3rdDim=true)</div><div class="ttdef"><b>Definition:</b> gtPlusSPIRIT.h:772</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 1 2016 09:11:15 for Gadgetron by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
